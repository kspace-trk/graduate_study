\chapter{システム構成}

本研究では，ユーザとCOMがテキサス・ホールデムを1対1で対戦することができるポーカーシステムを構築した．COMは，ゲームにおける情報を取得する情報入力部，表情およびアクションを決定する意思決定部，表情およびアクションをポーカーシステム上に出力する行動出力部からなる．また，COMのゲーム敗北時に限り，多数決機械の再学習を行い，ユーザに適合したCOMへと変化させる．構築したポーカーシステムプレイ中の画面を図\ref{fig:system-overview}に示す．


\section{情報入力部}

ユーザ情報入力部ではユーザの顔面骨格座標，COMの手札，COMの賭け金，COMの持ち金，ユーザの賭け金，ユーザの持ち金，COMの手番，場のカード，ユーザの行動を取得し，COMに与えられる．
COMの手札および場のカードは勝率の算出を行ったうえで意思決定に用いられる．

\begin{figure}[tbph]
	\begin{center}
		\includegraphics[scale=1.8]{image/system-overview.eps}
		\caption{ポーカーシステムプレイ中の画面}
		\label{fig:system-overview}
	\end{center}
\end{figure}


\subsection{勝利確率の算出}
COMの手札2枚と現在判明している場のカードからモンテカルロシミュレーションを用いて1000回の仮想的な勝負を行うことで勝利確率を算出する．
ゲームの進行状況に応じて場のカードの公開情報は変わるため，場のカードが5枚に満たない場合はCOM視点から不明なカードを仮の山札とし，場のカードが5枚になるように仮の山札からランダムにカードを配布する．


\subsection{顔面骨格座標の取得}

本研究ではTensorflowの学習済みモデルを用いて2次元で顔面骨格座標を取得する．ユーザの顔面骨格座標は輪郭が17点，右眉と左眉が5点ずつ，右目と左目が6点ずつ，鼻が9点，口が32点の計68点で構成される．取得した例を図\ref{faceborn}に示す．

また，顔面骨格座標はユーザが画面のどの位置に存在するかによって値が大きく変化するため，鼻の頂点と各頂点の距離を求め，多数決機械に与える他の値と揃えるため，300で除算したものを各頂点座標としている．

\begin{figure}[tbhp]
	\begin{center}
		\includegraphics[scale=1.8]{image/faceborn.eps}
		\caption{取得した顔面骨格情報の例}
		\label{faceborn}
	\end{center}
\end{figure}



\section{意思決定部}

正規化された顔面骨格座標，COMの算出した勝率，COMの賭け金と持ち金，ユーザの賭け金と持ち金，ユーザの行動，COMの手番に加え，各アクション情報をアクション決定用の多数決機械，各表情情報を表情決定用の多数決機械にそれぞれ入力として与えてCOMの行動を決定する．
それぞれの多数決機械に行動を順々に入力し，多数決機械内部の線形識別機械の出力において基準値を超えたものを対象した上で，最終的に対象となる各行動の期待値に基づき確率に用いて行動を決定する．図\ref{roulette}にアクションの決定方法のイメージを示す．

また，アクションの決定時には，現在のゲーム状況に応じて可能なものに限り多数決機械に入力として与える．また，チェックとフォールドが可能な状況に限り，チェックができるにもかかわらずフォールドをするメリットが存在しないため，フォールドは選択不可になる．



\section{行動出力部}

行動出力部では意思決定部で決定したアクション及び表情を画面に出力し，ユーザに対して出力する．表情一覧を図\ref{face-list}に示す．

表情の定義に関してはエクマン理論が存在するが，日本人の表情はエクマン理論とは異なることが先行研究によって明らかになっている\cite{Sato19}．Satoらは日本人のイメージにおける表情とエクマン理論における表情の差異を検証し，幸福および驚きに関しては違いはないが，怒り，嫌悪，恐怖，悲しみに関してはエクマン理論に比べ，あまり表情に表れないを実証した．したがって，現実に則したポーカーを再現するためにSatoらの先行研究を踏まえ，COMの表情は表情として表れづらいものを含めた落ち着き，喜び，悲しみ，驚き，疑い，思考，焦りを基本とした計19種類から構成される．

\begin{figure}[tbhp]
	\begin{center}
		\includegraphics[scale=0.45]{image/roulette.eps}
		\caption{期待値に基づく確率を用いたアクション決定イメージ}
		\label{roulette}
	\end{center}
\end{figure}

\begin{figure}[tbhp]
	\begin{center}
		\includegraphics[scale=0.42]{image/face-list.eps}
		\caption{表情一覧}
		\label{face-list}
	\end{center}
\end{figure}